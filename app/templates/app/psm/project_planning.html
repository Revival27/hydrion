{% extends "app/psm/psm.html"%}
{% load i18n static settings %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'app/css/project_planning.css' %}">
{% if report %}
<div class="container">
    <div class="row">
        <div class="col">
            <h4><b>{{report.name}}</b></h4>
            <div>Created at: {{report.created_at}}</div>
            <div>{{report.efficiency}}</div>
           {% for ts in tasks_status %}
           {{ts}}
           {% endfor %}
        <hr>
        </div>
    </div>
</div>
{% endif %}
{% if "reports" in request.path %}
<div class="container">
    <div class="row">
        <div class="col">
            <h1 style="font-size: 400; margin-bottom: 20px;"><b>{% trans 'Statistics' %}</b></h1>
            <ul class="list-group">
                {% for report in reports %}
                <li class="list-group-item">
                    {{report}}
                    {{report.name}}
                    {{report.created_at}}
                    {{report.efficiency}}
                    <a href="/psm/project_planning/report/{{report.id}}/"><i class="fa-solid fa-arrow-up-right-from-square"></i></a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endif %}
{% if project.id %}
<div class="container">
    <div class="row">
        <div class="col">
                <h4><b>{{project.name}}</b></h4>
                <div>{% trans 'Created at'%}: {{project.created_at}}</div>
                <div>{% trans 'Project owner' %}: Test User 01</div>
                <a href="/psm/edit_project"><i class="fa-solid fa-pen"></i></a>
            <hr>
            <h5>{% trans 'Project Team' %} {{project.team_id}}</h5>
            <ul>
               {% for team_member in team_members %}
               <li>
                <ul><li>{{team_member}}</li><li>{{team_member.title}}</li></ul>
               </li>
               {% endfor %}
            </ul>
            <hr>
            <h5>{% trans 'Description' %}</h5>
            {% if project.description|length > 500 %}
            <p>{{project.description|slice:":500"}}
            <span id="more_text" style="display: none;">{{project.description|slice:"500:"}}</span>
            <button class="btn btn-secondary" id="btn-description" onclick="toggleText()">{% trans 'More' %}</button>
            </p>
            {% else %}
            <p>{{project.description}}</p>
            {% endif %}
            <hr>
            <h5><b>{% trans 'Tasks list' %}</b></h5>
            <ul>
                {% for task in tasks %}
                    <li>
                        <ul><li>{{task.name}}</li><li>{{task.deadline}} </li><li>{{task.status}}</li><li>{{task.start_date}}</li></ul> 
                    </li>
                {% endfor %}
            </ul>
            <button class="btn btn-secondary" type="button" onclick="toggleForm()"><i class="fa-solid fa-plus"></i> {% trans 'New Task' %}</button>
            <div >
                <form action="/psm/project_planning/project/{{project.id}}/" method="post" id="task_form" style="display: none;">
                {% csrf_token %}
                <label for="task_name" class="form-label">{% trans 'Name' %}</label>
                <input type="text" class="form-control" id="task_name" name="task_name" required>
                <label for="task_start_date" class="form-label">{% trans 'Start Date' %}</label>
                <input type="date" id="task_start_date" class="form-control" name="task_start_date" required>
                <label for="task_deadline" class="form-label">{% trans 'Deadline' %}</label>
                <input type="date" id="task_deadline" class="form-control" name="task_deadline" required>
                <label for="task_status" class="form-label" >{% trans 'Status' %}</label>
                <select name="task_status" id="task_status" class="form-control" required>
                    {% for task_status in task_statuses %}
                        <option value="{{task_status.id}}" {%if task.status.id == task_status.id%} selected {%endif%}>{{task_status.name}}</option>
                    {% endfor %}
                </select>
                <label for="task_description" class="form-label">{% trans 'Description' %}</label>
                <input type="text" class="form-control" id="task_description" name="task_description">
                <input type="number" name="project_id" value="{{project.id}}" hidden>
                <button class="btn btn-primary">{% trans 'Invite' %}</button>
                <button type="submit" class="btn btn-primary"> {% trans 'New task' %}</button>
                
            </form>
            {% if add_new_task %}
                <div class="alert alert-success" role="alert">
                    {% trans 'Successfully added new task!' %}
                </div>
            {% endif %} 
            </div>
            <hr>
            <h5><b>{% trans 'Attachments' %}</b></h5>
            <ul>
                <li>
                    Attachment 01
                    {% trans 'Uploaded' %}: 2024.02.02.
                    {% trans 'Format' %}: PDF
                    {% trans 'Size' %}: 3.7 MB
                </li>
            </ul>
            <button class="btn btn-secondary"><i class="fa-solid fa-plus"></i>{% trans 'New Attachment' %}</button>
        </div>
        <div class="col">
            <form action="/psm/project_planning/project/{{project.id}}/save/" method="post">
                {% csrf_token %}
                <label class="form-label" for="status" >{% trans 'Status' %}</label>
                <select class="form-control" id="status" name="project_status">
                    {% for status in statuses %}
                        <option value="{{status.id}}" {%if project.status.id == status.id%} selected {%endif%}>{{status.name}}</option>
                    {% endfor %}
                </select>
                <label class="form-label" for="deadline">{% trans 'Deadline' %}</label>
                <input class="form-control" type="date" value="{{project.deadline|date:'Y-m-d'}}" name="project_deadline">
                <button class="btn btn-primary" type="submit">{% trans 'Save' %}</button>            
            </form>
            <button class="btn btn-secondary">{% trans 'Calendar view' %}</button>
            <form action="/psm/project_planning/report/{{project.report_id}}/" method="post">
                {% csrf_token %}
                <input type="text" name="project_id" value="{{project.id}}" hidden>
                <button class="btn btn-secondary"><i class="fa-solid fa-chart-simple"></i> {% trans 'Report' %}</button>
            </form>
            <hr>
            <button class="btn btn-primary">{% trans 'Close Project' %}</button>
            <form action="/psm/project_planning/project/{{project.id}}/delete/" method="post">
                {% csrf_token %}
                <input class="btn btn-secondary" name="project.id" value="{% trans 'Delete Project' %}" type="submit">
            </form>
            <form action="/psm/calendar/project/{{project.id}}/" method="post">
                {% csrf_token %}
                <input class="btn btn-secondary" type="submit" value="Calendar view" name="Submit" id="frm1_submit" />
            </form>  
        </div>
    </div>
</div>
{% endif %}
{% if projects %}
<div class="container">
    <div class="row">
        <div class="col">
            <h1 style="font-size: 400; margin-bottom: 20px;"><b>{% trans 'Projects' %}</b></h1>
            <table class="project-table">
                <thead>
                    <tr>
                        <th>{% trans 'Name' %}</th>
                        <th>{% trans 'Created' %}</th>
                        <th>{% trans 'Deadline' %}</th>
                        <th>{% trans 'Status' %}</th>
                        <th>{% trans 'Details' %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for project in projects %}
                    <tr>
                        <td>{{ project.name }}</td>
                        <td>{{ project.created_at|date:"Y-m-d" }}</td>
                        <td>{{ project.deadline|date:"Y-m-d" }}</td>
                        <td>{{ project.project_status }}</td>
                        <td style="text-align: center;"><a href="/psm/project_planning/project/{{ project.id }}/"><i class="fa-solid fa-arrow-up-right-from-square"></i></a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="btn_container"><button id="add_new_project_btn" class="btn btn-primary"><i class="fa-solid fa-plus"></i> <a href="/psm/project_planning/add_project/">New Project</a></button></div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
