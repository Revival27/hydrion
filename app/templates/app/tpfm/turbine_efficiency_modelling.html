{% extends "app/tpfm/tpfm.html" %}
{% load i18n static %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'app/css/tpfm_dashboard.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'app/css/turbine_efficiency_modelling.css' %}">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <div class="container">
    <div class="row">
      <div class="col-sm-col-md-8 col-lg-9">
        <h2 class="h2">{% trans 'Turbine efficiency modelling' %}</h2>
        <dl class="text-muted">
          <dt>I. {% trans 'Select a turbine type from the table.' %}</dt>
          <dt>II. {% trans 'Type the parameters into the Calculator.' %}</dt>
          <dt>III. {% trans 'Press Calculate button.' %}</dt>
        </dl>
        <div class="tab">
          <button class="tablinks" onclick="openTurbine(event, 'Turbulent')">{% trans 'Turbulent' %}</button>
          <button class="tablinks" onclick="openTurbine(event, 'Lucid Energy')">Lucid Energy</button>
          <button class="tablinks" onclick="openTurbine(event, 'Ossberger')">Ossberger</button>
          <button class="tablinks" onclick="openTurbine(event, 'HydroWatt')">HydroWatt</button>
        </div>        
        <div id="Turbulent" class="tabcontent">
          <h3>{% trans 'Turbulent types' %}</h3>
          <div>
            <table class="table">
                <thead>
                    <tr>
                        <th>{% trans 'Name' %}</th>
                        <th>{% trans 'Vortex' %}</th>
                        <th>{% trans 'Type' %}</th>
                        <th>{% trans 'Water Level' %}</th>
                        <th>{% trans 'Continous' %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for turbine in turbines %}
                    <tr class="table-row" onclick="selectTurbine(this)">
                        <td>{{turbine.name}}</td>
                        <td>{{turbine.vortex}} kW</td>
                        <td>{{turbine.turbine_type}}</td>
                        <td>{{turbine.water_level}}</td>
                        <td>{{turbine.continous}}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
          </div>
        </div>
        <div id="Lucid Energy" class="tabcontent">
          <h3>Lucid Energy</h3>
          <img src="/static/app/img/pipe-turbine.jpg" alt="lucid turbine" class="img-responsive">
        </div>
        <div id="Ossberger" class="tabcontent">
          <h3>Ossberger</h3>
          <img src="/static/app/img/ossberger.png" alt="ossberger turbine" class="img-responsive">
        </div>
        <div id="HydroWatt" class="tabcontent">
            <h3>HydroWatt</h3>
        </div>
        <div id="calculator">
          <form action="/tpfm/turbine_efficiency_modelling/" method="post" class="form">
            {% csrf_token %}
            <fieldset id="efficiencyForm" disabled >
              <legend>{% trans 'Calculate turbine efficiency' %}</legend>
                <h3>{% trans 'Selected turbine:' %}<span id="selectedTurbineName"></span></h3>
                <div class="mb-3">
                  <label for="rho" class="form-label">{% trans 'œÅ: Densitiy of water in kg/m¬≥' %}</label>
                  <div class="dropdown">
                    <button id="info-rho" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fa-solid fa-circle-info"></i>
                      <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu alert alert-info" aria-labelledby="dLabel">
                      <li class="dropdown-item">
                        <p>
                          {% trans 'The symbol  ùúå œÅ (rho) in the context of calculating the efficiency of hydro power plant turbines stands for density. Specifically, it represents the density of the water, which is a crucial factor in determining the potential energy available from the water flow. The density of water is typically considered to be approximately 1000 kg/m¬≥ under standard conditions.' %}
                        </p>
                      </li>
                    </ul>
                  </div>
                  <input type="number" step="0.01" id="rho" class="form-control" value="{{rho}}" name="rho" >
                </div>
                <div class="mb-3">
                    <label for="g" class="form-label">{% trans 'g: Acceleration due to gravity in m/s¬≤' %}</label>
                    <div class="dropdown">
                      <button id="info-gravity" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa-solid fa-circle-info"></i>
                        <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu alert alert-info" aria-labelledby="dLabel">
                        <li class="dropdown-item">
                          <p>
                            {% trans 'g is the acceleration due to gravity (9.81 m/s¬≤).' %}
                          </p>
                        </li>
                      </ul>
                    </div>
                    <input type="number" step="0.01" id="g" class="form-control" value="{{g}}" name="g">
                </div>
                <div class="mb-3">
                    <label for="Q" class="form-label">{% trans 'Q: Volumetric flow rate in m¬≥/s' %}</label>
                    <div class="dropdown">
                      <button id="info-volumetric-flow-rate" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa-solid fa-circle-info"></i>
                        <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu alert alert-info" aria-labelledby="dLabel">
                        <li class="dropdown-item">
                          <p>
                            {% trans 'Q is the volumetric flow rate of water (in cubic meters per second, m¬≥/s).' %}
                          </p>
                        </li>
                      </ul>
                    </div>
                    <input type="number" step="0.01" id="Q" class="form-control" value="{{Q}}" name="Q">
                </div>
                <div class="mb-3">
                    <label for="H" class="form-label">{% trans 'H: effective head in meter' %}</label>
                    <div class="dropdown">
                      <button id="info-effective-head" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa-solid fa-circle-info"></i>
                        <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu alert alert-info" aria-labelledby="dLabel">
                        <li class="dropdown-item">
                          <p>
                            {% trans 'In the context of the general formula for turbine efficiency, the term "effective head" (ùêª) refers to the height or pressure difference through which water falls or flows over the turbine blades. It represents the potential energy available from the water flow and is a crucial factor in determining the input power (ùëÉ·µ¢‚Çô‚Äã) of the turbine. The effective head can be measured in meters and is often calculated as the difference in elevation between the water source (such as a reservoir or dam) and the turbine, accounting for any losses due to friction, bends in the pipeline, or other factors that may affect the water flow. In some cases, the effective head may also include the velocity head, which accounts for the kinetic energy of the water flow. This is particularly relevant for turbines that harness energy from fast-moving streams or rivers. Overall, the effective head represents the driving force behind the operation of turbine, as it determines the potential energy available from the water flow, which the turbine converts into mechanical or electrical energy.' %}
                          </p>
                        </li>
                      </ul>
                    </div>
                    <input type="number" step="0.01" id="H" class="form-control" value="{{H}}" name="H">
                </div>
                <div class="mb-3">
                    <label for="P_out" class="form-label">{% trans 'Output power in Kw' %}</label>
                    <div class="dropdown">
                      <button id="info-output-power" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa-solid fa-circle-info"></i>
                        <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu alert alert-info" aria-labelledby="dLabel">
                        <li class="dropdown-item">
                          <p>
                            {% trans 'Output power is the actual mechanical or electrical power produced by the turbine. If you are measuring the electrical output, it can be determined using the electrical power formula: P‚Çí·µ§‚Çú=V‚ãÖI‚ãÖcos(œï)' %}
                          </p>
                        </li>
                      </ul>
                    </div>
                    <input type="number" step="0.01" id="P_out" class="form-control" value="{{P_out}}" name="P_out">
                </div>
                <div class="mb-3">
                    <label for="P_in" class="form-label">{% trans 'Input power in watts:' %}</label>
                    <div class="dropdown">
                      <button id="info-input-power" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa-solid fa-circle-info"></i>
                        <span class="caret"></span>
                      </button>
                      <ul class="dropdown-menu alert alert-info" aria-labelledby="dLabel">
                        <li class="dropdown-item">
                          <p>
                            {% trans 'The input power is derived from the potential energy of the water flowing through the turbine. It can be calculated using the following formula: ùëÉ·µ¢‚Çô = ùúå ‚ãÖ ùëî ‚ãÖ ùëÑ ‚ãÖ ùêª' %}
                          </p>
                        </li>
                      </ul>
                    </div>
                    <input type="number" id="inputPower" class="form-control" value="{{P_in}}" name="input_power" disabled>
                </div>
                <button type="submit" class="btn btn-primary">{% trans 'Calculate' %}</button>
              </fieldset>
        </form>
      </div>
      </div>
      
      <div class="col-md-4 col-lg-3">
        <label for="efficiency" class="form-label">{% trans 'Calculated efficiency' %}</label>
        <div name="efficiency">{{efficiency}} %</div>     
      </div>
    </div>
  </div>
  <script>
    function selectTurbine(row) {
        // Deselect previously selected row
        var selected = document.querySelectorAll(".selected");
        selected.forEach(function(row) {
            row.classList.remove("selected");
        });

        // Select the clicked row
        row.classList.add("selected");

        // Enable the form and set selected turbine name
        var form = document.getElementById("efficiencyForm");
        form.removeAttribute("disabled");

        var selectedTurbineName = row.cells[0].innerText;
        document.getElementById("selectedTurbineName").innerText = selectedTurbineName;

        // Set values for inputs if needed (example with placeholder input)
        document.getElementById("disabledTextInput").value = selectedTurbineName; // Or other relevant data
    }
    function openTurbine(evt, turbineName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(turbineName).style.display = "block";
      evt.currentTarget.className += " active";
    }
  </script>
{% endblock %}
       